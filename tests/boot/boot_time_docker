#!/bin/bash

set -e

GVISOR=""

if [ "$1" == "--gvisor" ]; then
    GVISOR="gvisor-"
fi

ITERATIONS=10
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
OUTPUT_DIR=$DIR/output
DATETIME=$(date +%Y-%m-%dT%H:%M:%S%z)
LOGFILE_NAME=$OUTPUT_DIR/$DATETIME-docker-${GVISOR}boot-time.log

launch_container() {
    docker run --rm -d sysbench:latest /bin/bash
}

run_test() {
    for ((i=1; i<=$ITERATIONS;i++)); do
        time launch_container
    done
}

run_test &> $LOGFILE_NAME

